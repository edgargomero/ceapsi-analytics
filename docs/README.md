# üìû CEAPSI - Sistema PCF (Precision Call Forecast)

Sistema completo de predicci√≥n de llamadas para call center usando inteligencia artificial y an√°lisis avanzado de datos.

üìÅ **¬°Sube tu propio archivo de datos de llamadas y comienza el an√°lisis inmediatamente!**

## üéØ Caracter√≠sticas Principales

- **ü§ñ M√∫ltiples Modelos de IA**: ARIMA, Prophet, Random Forest, Gradient Boosting
- **üìä Dashboard Simplificado**: Interfaz intuitiva siguiendo mejores pr√°cticas UX/UI
- **üá®üá± An√°lisis de Feriados**: Integraci√≥n completa de feriados chilenos 2023-2025
- **üìà An√°lisis Comparativo**: Comparaci√≥n por hora, d√≠a de semana y patrones estacionales
- **üîç Auditor√≠a de Datos**: An√°lisis autom√°tico de calidad y patrones
- **üîÄ Segmentaci√≥n Inteligente**: Clasificaci√≥n autom√°tica de llamadas entrantes/salientes
- **üö® Sistema de Alertas**: Detecci√≥n proactiva de picos de demanda
- **‚öôÔ∏è Pipeline con Progreso**: Seguimiento visual del estado de ejecuci√≥n
- **üåê Interfaz en Espa√±ol**: Totalmente localizada con semanas iniciando en lunes

## üöÄ Despliegue y Configuraci√≥n

### üåê Despliegue en Streamlit Cloud

Este proyecto est√° **desplegado en Streamlit Cloud** con las siguientes caracter√≠sticas:

- **üóÑÔ∏è Base de Datos**: Supabase Cloud
- **üîê Variables de Entorno**: Configuradas en Streamlit Secrets
- **üîó API Integration**: Conexi√≥n con Reservo API para datos en tiempo real
- **üìä Dashboard**: Acceso web directo sin instalaci√≥n local

### Configuraci√≥n de Streamlit Secrets

Las variables de entorno se configuran en Streamlit Secrets (`.streamlit/secrets.toml`):

```toml
# Supabase Configuration
SUPABASE_URL = "https://your-project-id.supabase.co"
SUPABASE_KEY = "your-supabase-service-role-key"
SUPABASE_ANON_KEY = "your-supabase-anon-key"

# Reservo API Integration
RESERVO_API_URL = "https://api.reservo.cl"
RESERVO_API_KEY = "your-reservo-api-key"
RESERVO_CLIENT_ID = "your-client-id"

# Application Settings
APP_NAME = "CEAPSI_PCF"
LOG_LEVEL = "INFO"
```

### üîó Conexi√≥n con Reservo API

El sistema integra datos directamente desde Reservo API:

- **üìû Datos de Llamadas**: Sincronizaci√≥n autom√°tica cada 15 minutos
- **üë• Informaci√≥n de Agentes**: Estado y disponibilidad en tiempo real
- **üìä M√©tricas de Performance**: KPIs actualizados autom√°ticamente
- **üîÑ Estado de Conexi√≥n**: Monitor visual en el frontend

### Instalaci√≥n Local (Desarrollo)

Si necesitas ejecutar localmente:

1. **Instalar dependencias**
   ```bash
   pip install -r requirements.txt
   ```

2. **Configurar variables de entorno**
   ```bash
   # Crear archivo .env con las credenciales de Supabase y Reservo
   cp .env.example .env
   ```

3. **Ejecutar aplicaci√≥n**
   ```bash
   streamlit run app.py
   ```

**M√≥dulos Individuales**
```bash
# Auditor√≠a de datos
python auditoria_datos_llamadas.py

# Segmentaci√≥n de llamadas  
python segmentacion_llamadas.py

# Sistema multi-modelo
python sistema_multi_modelo.py

# Automatizaci√≥n completa
python automatizacion_completa.py
```

## üìä Estructura del Proyecto

```
pcf_scripts/
‚îú‚îÄ‚îÄ üì± app.py                          # Aplicaci√≥n principal Streamlit
‚îú‚îÄ‚îÄ üìä dashboard_comparacion.py        # Dashboard simplificado UX/UI
‚îú‚îÄ‚îÄ üá®üá± feriados_chilenos.py           # Sistema de feriados chilenos integrado
‚îú‚îÄ‚îÄ üîç auditoria_datos_llamadas.py     # Auditor√≠a de calidad de datos
‚îú‚îÄ‚îÄ üìä preparacion_datos.py            # M√≥dulo de preparaci√≥n de datos
‚îú‚îÄ‚îÄ üîÄ segmentacion_llamadas.py        # Segmentaci√≥n de llamadas
‚îú‚îÄ‚îÄ ü§ñ sistema_multi_modelo.py         # Sistema multi-modelo
‚îú‚îÄ‚îÄ ‚öôÔ∏è automatizacion_completa.py      # Pipeline automatizado con progreso
‚îú‚îÄ‚îÄ üé® ux_mejoras.py                   # Mejoras de experiencia de usuario
‚îú‚îÄ‚îÄ üìã requirements.txt                # Dependencias
‚îú‚îÄ‚îÄ üìñ README.md                       # Esta documentaci√≥n
‚îú‚îÄ‚îÄ üìù ejemplo_datos_llamadas.csv      # Datos de ejemplo
‚îú‚îÄ‚îÄ üéÑ feriadoschile.csv               # Base de datos de feriados
‚îî‚îÄ‚îÄ .streamlit/
    ‚îî‚îÄ‚îÄ config.toml                    # Configuraci√≥n de Streamlit
```

## üìÅ Formato de Datos Esperado

### Columnas Requeridas

| Columna | Descripci√≥n | Ejemplo |
|---------|-------------|----------|
| **FECHA** | Fecha y hora de la llamada | 02-01-2023 08:08:07 |
| **TELEFONO** | N√∫mero de tel√©fono | +56912345678 |
| **SENTIDO** | Tipo de llamada | 'in' (entrante) o 'out' (saliente) |
| **ATENDIDA** | Estado de atenci√≥n | 'Si' o 'No' |

### Formato del Archivo

- **Separador**: Punto y coma (;)
- **Encoding**: UTF-8, Latin-1, o CP1252
- **Formato de fecha**: DD-MM-YYYY HH:MM:SS
- **Extensiones**: .csv, .xlsx, .xls

### Ejemplo de Archivo CSV

```csv
FECHA;TELEFONO;SENTIDO;ATENDIDA;STATUS
02-01-2023 08:08:07;+56912345678;in;Si;ANSWERED
02-01-2023 08:15:23;+56987654321;out;No;NO_ANSWER
02-01-2023 08:22:45;+56923456789;in;Si;ANSWERED
```

üìé **Descarga el archivo `ejemplo_datos_llamadas.csv` desde la aplicaci√≥n para ver el formato completo.**

## üéÆ Gu√≠a de Uso

### 1. üè† P√°gina de Inicio
- Resumen del sistema y m√©tricas principales
- Enlaces r√°pidos a los m√≥dulos
- Estado actual del sistema
- **üìÅ Secci√≥n de carga de archivos en el sidebar**

### 2. üìä Dashboard Simplificado (Nuevas Funcionalidades)
- **üìà An√°lisis Comparativo**: Pesta√±as organizadas para mejor navegaci√≥n
- **‚è∞ An√°lisis por Horas**: Patrones detallados por hora del d√≠a
- **üìÖ An√°lisis Semanal**: Comparaci√≥n por d√≠as de la semana (Lunes a Domingo)
- **üá®üá± Impacto de Feriados**: An√°lisis espec√≠fico de feriados chilenos
- **üìä M√©tricas Clave**: KPIs principales en formato visual intuitivo
- **üåê Interfaz en Espa√±ol**: Gr√°ficos, etiquetas y navegaci√≥n completamente en espa√±ol

### 3. üîç Auditor√≠a de Datos
- An√°lisis autom√°tico de calidad de datos
- Detecci√≥n de patrones temporales
- Identificaci√≥n de outliers y anomal√≠as
- Generaci√≥n de reportes de diagn√≥stico

### 4. üîÄ Segmentaci√≥n de Llamadas
- Clasificaci√≥n autom√°tica por tipo (entrante/saliente)
- An√°lisis de patrones horarios
- Validaci√≥n de confianza de clasificaci√≥n
- Generaci√≥n de datasets separados

### 5. ü§ñ Sistema Multi-Modelo
- Entrenamiento de m√∫ltiples algoritmos
- Ensemble autom√°tico con pesos optimizados
- Validaci√≥n cruzada temporal
- Generaci√≥n de predicciones para 28 d√≠as

### 6. üá®üá± An√°lisis de Feriados Chilenos (NUEVO)
- **Base de datos integrada**: 53 feriados chilenos (2023-2025)
- **An√°lisis de impacto**: Comparaci√≥n de llamadas en d√≠as feriados vs normales
- **Categorizaci√≥n**: Feriados religiosos, c√≠vicos, electorales y culturales
- **Predicci√≥n mejorada**: Los modelos consideran el impacto de feriados autom√°ticamente

### 7. üìä Preparaci√≥n de Datos (NUEVO)
- **Carga flexible**: CSV, Excel y JSON
- **Validaci√≥n autom√°tica**: Verificaci√≥n de columnas requeridas
- **Mapeo inteligente**: Detecci√≥n autom√°tica de formatos de datos
- **Integraci√≥n API**: Conectividad con Reservo y otras fuentes

### 8. üîó Monitor de Conexi√≥n Reservo API (NUEVO)

El frontend incluye un **monitor visual en tiempo real** que muestra:

#### üü¢ Estado de Conexi√≥n
- **Indicador visual**: Sem√°foro de estado (Verde/Amarillo/Rojo)
- **√öltima sincronizaci√≥n**: Timestamp de la √∫ltima actualizaci√≥n exitosa
- **Latencia**: Tiempo de respuesta de la API en milisegundos
- **Registros procesados**: Contador de llamadas sincronizadas

#### üìä Panel de Control API
```
üîÑ Estado Reservo API
‚îú‚îÄ‚îÄ üü¢ CONECTADO | √öltima sync: 14:25:30
‚îú‚îÄ‚îÄ ‚è±Ô∏è Latencia: 245ms | Pr√≥xima sync: 14:40:00
‚îú‚îÄ‚îÄ üìû Llamadas procesadas: 1,247 hoy
‚îú‚îÄ‚îÄ üë• Agentes activos: 15/20
‚îî‚îÄ‚îÄ üìà Tasa de √©xito: 98.5%
```

#### üö® Alertas de Conexi√≥n
- **Alerta amarilla**: Latencia > 1000ms o errores < 5%
- **Alerta roja**: Sin conexi√≥n > 30 minutos
- **Notificaci√≥n**: Pop-up autom√°tico en caso de fallas
- **Reintentos**: L√≥gica autom√°tica de reconexi√≥n

#### üìã Log de Actividad API
El sidebar incluye un log en tiempo real:
```
[14:25:30] ‚úÖ Sync exitosa - 45 nuevas llamadas
[14:25:15] ‚ö†Ô∏è Latencia alta detectada (1.2s)
[14:10:30] ‚úÖ Sync exitosa - 38 nuevas llamadas
[14:09:45] üîÑ Reconectando a Reservo API...
```

### 9. ‚öôÔ∏è Automatizaci√≥n con Progreso
- Pipeline completo automatizado con **indicadores visuales de progreso**
- **Barra de estado**: Seguimiento en tiempo real del proceso
- **Estimaci√≥n de tiempo**: Tiempo restante para completar
- Programaci√≥n de ejecuciones
- Sistema de notificaciones

## üìà M√©tricas y Objetivos

| M√©trica | Objetivo | Descripci√≥n |
|---------|----------|-------------|
| **MAE** | < 10 llamadas/d√≠a | Error absoluto promedio |
| **RMSE** | < 15 llamadas/d√≠a | Error cuadr√°tico medio |
| **MAPE** | < 25% | Error porcentual absoluto |
| **Precisi√≥n Alertas** | > 90% | Precisi√≥n del sistema de alertas |

## üîß Configuraci√≥n Avanzada

### Personalizar Objetivos de Performance

Editar los valores en `sistema_multi_modelo.py`:

```python
config_default = {
    'objetivos_performance': {
        'mae_objetivo': 10.0,        # Cambiar seg√∫n necesidad
        'rmse_objetivo': 15.0,       # Cambiar seg√∫n necesidad
        'mape_objetivo': 25.0        # Cambiar seg√∫n necesidad
    }
}
```

### Configurar Automatizaci√≥n

Editar `automatizacion_completa.py` para:
- Horarios de ejecuci√≥n
- Destinatarios de notificaciones
- Configuraci√≥n de email
- Umbrales de alertas

### Personalizar Dashboard

El dashboard es completamente personalizable editando `dashboard_comparacion.py`:
- Agregar nuevos tipos de gr√°ficas
- Modificar m√©tricas mostradas
- Cambiar colores y temas
- Agregar nuevos an√°lisis

## üö® Soluci√≥n de Problemas

### Error: "No se pudieron cargar los datos"
- Verificar que el archivo de datos existe en la ruta correcta
- Comprobar permisos de lectura del archivo
- Validar formato del archivo CSV

### Error: "Modelos no encontrados"
- Ejecutar primero la segmentaci√≥n de llamadas
- Luego entrenar los modelos multi-modelo
- Verificar que se generaron los archivos JSON de resultados

### Error de dependencias
```bash
# Reinstalar dependencias
pip install --upgrade -r requirements.txt

# Si hay conflictos, usar entorno virtual
python -m venv venv
source venv/bin/activate  # En Windows: venv\Scripts\activate
pip install -r requirements.txt
```

### Performance lenta
- Reducir el per√≠odo de datos para an√°lisis
- Usar menos modelos en el ensemble
- Optimizar configuraci√≥n de Streamlit

## üìû Soporte

Para soporte t√©cnico o preguntas sobre el sistema:

- **Email**: soporte@ceapsi.cl
- **Documentaci√≥n**: Usar el m√≥dulo "üìã Documentaci√≥n" en la aplicaci√≥n
- **Logs**: Revisar archivos de log generados autom√°ticamente

## üîÑ Actualizaciones

### Versi√≥n 1.0 - Actual
- ‚úÖ Sistema multi-modelo completo
- ‚úÖ Dashboard interactivo
- ‚úÖ An√°lisis de atenci√≥n hist√≥rica
- ‚úÖ Automatizaci√≥n programada
- ‚úÖ Sistema de alertas avanzado

### Pr√≥ximas Versiones
- ‚úÖ Integraci√≥n con Reservo API en tiempo real (IMPLEMENTADO)
- üîÑ Modelos de deep learning (LSTM, Transformer)
- üîÑ Predicci√≥n por agente individual
- üîÑ Optimizaci√≥n autom√°tica de turnos
- üîÑ Dashboard m√≥vil para supervisores

## üìÑ Licencia

Este proyecto es propiedad de CEAPSI y est√° destinado para uso interno.

---

**üìû CEAPSI - Precision Call Forecast** | Desarrollado con ‚ù§Ô∏è para optimizar la experiencia del call center
